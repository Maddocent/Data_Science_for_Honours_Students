---
title: "DSfHP_ALL"
author: "Dr. Marc A.T. Teunis"
date: "25 januari 2016"
output:
  html_document:
    highlight: kate
    theme: spacelab
    toc: yes
  word_document:
    highlight: pygments
---
# COURSE: DATA SCIENCE FOR HONOURS STUDENTS

<style type="text/css">

body, td {
   font-size: 18px;
}
code.r{
  font-size: 18px;
}
pre {
  font-size: 18px
}
</style>


```{r, echo=FALSE, results='hide', message=FALSE}

library(knitr)
library(data.table)
library(plyr)
library(dplyr)

```

## How to read this document
First, some pointers on how to read this document:

 1. This document has been written in a scripting laguage called R-Markdown. This language provides the possibility to integrate code, it's output and 'narratives' together.

 2. Whenever you see this `code line` that means that this a short example of code (R script) that you can try for yourself in RStudio.

 3. Whenever you see this 
```{r, code chunck}
calculation_result <- (log10((2*233)^2))*1000 
calculation_result
```
The code is indicated in a gray area, the result of the code in a gray or white area and the result is indicated with ## (2 hashtags).

Thoughout the text of the document:

 4. Functions are indicated as **_some function_**

 5. Package names and packages are indicated as {some package}

# UNIT 2: Installing R and RStudio, packages, settings and getting help 

## Topic 1: Download R and RStudio

### Installing R
To download and install R go to: https://cran.r-project.org/.
Select the appropriate Operating System (OS) that applies to your system. Download the .exe file to your computer and run it under administrator rights.
I can advise you to just download and install R with all the default settings unchanged. That will ensure a smooth expeRience and a proper integration with RStudio.

### Installing RStudio
To install RStudio go to: https://www.rstudio.com/products/rstudio/download/. Again, select the appropriate download for your OS. 

### Setting up GitHub account and creating a "Hello World" repository
To be able to access some of the code examples, handouts and other useful resources
for this course, as well as for submitting code for some of the assigments and for the project, you will have to set up an account for GitHub.
GitHub can be found at https//www.github.com

To start with your own GitHub repository I recommend going though the steps of creating your first repository named "Hello World"
In oder to do so follow the guidelines here: https://guides.github.com/activities/hello-world/

## _Assignment 1: Set up and submit your "Hello World" GitHub respository here:_
https://hubl.hu.nl/assignment/unit-2-installing-r-and-rstudio-assignment-1?9d54fc7a=15269

## The Working Directory and other settings
RStudio can be customized for many aspects. Most of the setting can be found under the 'tools' tab, under Global Settings. Her we discuss two options: 

 1. Changing the font size: 

The working directory is where R stores all the objects that you _*write*_ from R. It also the place where R looks if you command it to _read_

To set the global options for the working directory in RStudio watch this tutorial:

https://hubl.hu.nl/module/data-science-hp

...........................
To get information on the currently set working directory you can typ:
`getwd()` which will provide you with output in the console like

`[1] "C:/RWorkingDir"` 

which indicates that the currently set working directory is a folder called "RWorkingDir" and it is located directly in the root of the 'C:/' partition of the hard drive of my computer. 

### An important note on case sensitivity 
R is case sensitive; meaning that R knows the difference between a capital 'R' and a lower case 'r'. In fact it knows the whole alphabet and knows the difference between 'A' to 'Z' and 'a' to 'z'. Many errors come from the use of capitals where lowercase letter have to be used and vice versa. There is no real consensus on the use of capitals. Try to avoid them as much as possible so that you do not have to remember whether something was created using capitals or not. An important example are variable names in data frames and tables, which we will address in UNIT 3.  

As an example of the above point I will illustrate how objects are defined and named in R.

if we want to create an object, let's say a list of names we can use the following line:

```{r}

Names_list <- c("Joep", "John", "Mary", "Chris", "Jeff")

# Running this line of code in R will create an object named "Names_list".

# The object will appear in the upper right window of RStudio (this section is called the Global Environment)

# Symantics: a list like this is called a string or a vector that consists of character objects. 

# Character objects could be compared to 'text' in MS Office Excel
```
From the Global Environment (GlobalEnv) we can see that our newly created object has several characteristics:
1. 'chr' means that the object is of class 'character'
2. the length of the object is [number of rows, number of columns], in this case [1:5] means that is a one row that has 5 elements (names)
3. The elements that fit in the window are shown: "Joep" "Joh.... When you increase the size of the window, you will see more elements of the object.

If we type:
```{r}
Names_list
class(Names_list)
length(Names_list)
```
We see that the ouput provides us with comparable information on the object as we can see in the GlobalEnv.

Now try for yourself, and see what happens if you type:

`names(Names_List)`


### Using the working directory in R scripts
1. Non-relative paths: 


2. Relative paths:

















## Installing packages in R
R comes with the Base R installation. In the Base R installation several useful packages are included, but to make use of the ful poweR of R we need to install additional packages. To see the currently installed packages on your system:

```{r, InstalledPackages}
installedPackages <- as.data.frame(installed.packages())
installedPackages <- tbl_df(installedPackages)
rowNames <- as.vector(1:nrow(installedPackages))
rownames(installedPackages) <- rowNames 
print(installedPackages)
```

The number of installed packages can be obtained by looking at the dimensions of the table with the installed packages above. In this example (my own system) there were `r nrow(installedPackages)` packages installed. 

## Preparing for Lesson 1
To be able to work with the examples in Lesson 1 you will need to install several packages. The below code installs them for you:
remove the "#" in the code below, if you want to run the installation of the respective package. Some packages may be installed already on your system, depending on your level of experience. You can choose to do a new installation of the packages or skip this step if the packages below are already installed on your system. You can take a look at the table wit the packages that are installed on your system and that you have just created using `View(installedPackages)`. 

```{r, InstallPackages, echo=TRUE, results='hide', message=FALSE}
#install.packages("lubridate")
#install.packages("reshape2")
#install.packages("stringr")
#install.packages("plyr")
#install.packages("dplyr")
#install.packages("ggplot2")
#install.packages("pastecs")
#install.packages("reshape")

# to load these packages into R:
library(lubridate)
library(reshape2)
library(stringr)
library(plyr); library(dplyr)
library(ggplot2)
library(pastecs)
library(reshape)

```

One way to check whether a package is already installed is by typing:

```{r, eval=FALSE}
filter(installedPackages, Package=="name of package"
```

## The filter function {dplyr}
In the code above we used the **_filter_** function from the {dplyr} package (the package to which the function belongs is indicated between {} in this document, functions are indicated in italics) to check whether a package has been installe don our system. The **_filter_** function can be used to conditionally filter elements from a data table or data frame. The difference between a data table and a data frame will be explained later. To select items we used the `==` operator to filter only the rows that meet the criterion: in this case: `Package == "ggplot2"`. In this case there is only one package called ggplot2 and the 16 characteristics (variables) for this one package are listed to the console after the call.

Other, so-called _logical_ and _boolean_ operators in R are:

operator | what is does    
---------|-------------
`<`      | _less than_ 
`>`      |  _more than_ 
`<=`     |  _less than or equal to_
`>=`     |  _more than or equal to_
`|`      |  _or_
`&`      |  _and_

The **_filter_** function takes the general form:

`filter(data, variable operator "condition")`

Because **_filter_** is part of the functions of the "dplyr" package it only works if dplyr is loaded. If dplyr is not loaded you will get an error in the console stating:

`Error: could not find function filter`

This in general is an indication that you forgot to load (with the function _**library()**_) a package that defines the requested (or as we say in Rish: 'called') function. No problem, just go ahead and load the package with `library("package name")`. It happens to the best of us!

When we want to store the result of **_filter_** in new object we can execute:

`Filtered <- filter(data, variable == "condition")`

For example, when we want to see whether the plotting package "ggplot2" is installed on our system we can call:
```{r} 
ggplot2 <- filter(installedPackages, Package=="ggplot2")
print(ggplot2)
```

The above exercise provides a nice exampe of some of the basic syntax (language) principles of R. When you want to create an object from a calculation or from a _call_ to a function we use  

`objectName <- function(call)`

to assign the result of the function call to a new object and store this in the Global Environment. R can do some pretty complicated calculations for you, when you get a hang of it. But it can also function as a simple calculator. Try the following to see the calculative power of R:
```{r}
No_cells_Packages <- nrow(installedPackages) * ncol(installedPackages)
# how many cells does the data table have?
```

## A Life Sciences application: Cell culture experiment
Now let's try something more complicated:
Assume that we need to calculate a dilution factor for a cell culture experiment. We want to culture human stem cells in a 24-wells format culture vessel and expose them to four different concentration of a mutagenic substance Benzo-a-Pyrene (BaP). BaP has a molecular weight of 252.31 g/mol.
The concentration of the stock solution BaP needs to be 1E-3 mol/L. We want to expose the cells to four concentrations: 1E-4, 1E-5, 1E-6, 1E-7 mol/L.  

1. To make the dilutions we could do this in R in the following way

```{r}
stockBaP <- 1E-3
# BaP is soluble in water so we will use medium to dilute it
# the volume of the amount of medium that will finaly be in the well has to be 2 ml. 

# per concentration we need a 2x concentrated dilution so that we can dilute one part of cellsuspension with one part of substance dilution:

# the number of conditions is 
numerConditions <- 4+1

volumeSubstance <- (24/5)*1

# dilutions


  
  
  

# well 1-4: 1E-4 M BaP -> we 


# well 5-8: 1E-5 M Bap 


```

1. first we create a mother suspension of the cells by detaching the cells from the culture vessel, using trypsine
2. We make a 1:10 dilution of the 
3. The cells are counted with a Burker-Turk counting chamber


## Getting the data
Before we can move on to perfoming our first data manipulations we need to set the proper working directory.
To view the current working directory type:
```{r, eval=FALSE}
getwd()
```

To set the working directory use:



















```{r, eval=FALSE}

# Exercise 1: "billboard"
## Loading the required data set "" into R

To obtain the file a couple of steps are needed:
1. Set up an account for yourself on www.github.com if you did not already do this.
2) Create a new repository in your own account called: "hello-world". If you are unsure about this step: take a look at this instruction:

https://guides.github.com/activities/hello-world/

2) Navigate to the repository mentioned above and 'fork' the repository to your own repository


To download the data into R we will use a direct method. It does not matter if the code below does not make  sense to you.


The required data files for the exercise below are availabe
in your instructors Github directory:

The following
Download the file
https://github.com/Maddocent/tidy-data/blob/master/data/billboard.csv





source("xtable.r")

raw <- read.csv("billboard.csv")
raw <- raw[, c("year", "artist.inverted", "track", "time", "date.entered", "x1st.week", "x2nd.week", "x3rd.week", "x4th.week", "x5th.week", "x6th.week", "x7th.week", "x8th.week", "x9th.week", "x10th.week", "x11th.week", "x12th.week", "x13th.week", "x14th.week", "x15th.week", "x16th.week", "x17th.week", "x18th.week", "x19th.week", "x20th.week", "x21st.week", "x22nd.week", "x23rd.week", "x24th.week", "x25th.week", "x26th.week", "x27th.week", "x28th.week", "x29th.week", "x30th.week", "x31st.week", "x32nd.week", "x33rd.week", "x34th.week", "x35th.week", "x36th.week", "x37th.week", "x38th.week", "x39th.week", "x40th.week", "x41st.week", "x42nd.week", "x43rd.week", "x44th.week", "x45th.week", "x46th.week", "x47th.week", "x48th.week", "x49th.week", "x50th.week", "x51st.week", "x52nd.week", "x53rd.week", "x54th.week", "x55th.week", "x56th.week", "x57th.week", "x58th.week", "x59th.week", "x60th.week", "x61st.week", "x62nd.week", "x63rd.week", "x64th.week", "x65th.week", "x66th.week", "x67th.week", "x68th.week", "x69th.week", "x70th.week", "x71st.week", "x72nd.week", "x73rd.week", "x74th.week", "x75th.week", "x76th.week")]
names(raw)[2] <- "artist"

raw$artist <- iconv(raw$artist, "MAC", "ASCII//translit")
raw$track <- str_replace(raw$track, " \\(.*?\\)", "")
names(raw)[-(1:5)] <- str_c("wk", 1:76)
raw <- arrange(raw, year, artist, track)

long_name <- nchar(raw$track) > 20
raw$track[long_name] <- paste0(substr(raw$track[long_name], 0, 20), "...")


xtable(raw[c(1:3, 6:10), 1:8], "billboard-raw.tex")

clean <- melt(raw, id = 1:5, na.rm = T)
clean$week <- as.integer(str_replace_all(clean$variable, "[^0-9]+", ""))
clean$variable <- NULL

clean$date.entered <- ymd(clean$date.entered)
clean$date <- clean$date.entered + weeks(clean$week - 1)
clean$date.entered <- NULL
clean <- rename(clean, c("value" = "rank"))
clean <- arrange(clean, year, artist, track, time, week)
clean <- clean[c("year", "artist", "time", "track", "date", "week", "rank")]

clean_out <- mutate(clean, 
                    date = as.character(date))
xtable(clean_out[1:15, ], "billboard-clean.tex")

# Normalisation --------------------------------------------------------------

song <- unrowname(unique(clean[c("artist", "track", "time")]))
song$id <- 1:nrow(song)

narrow <- song[1:15, c("id","artist", "track", "time")]
xtable(narrow, "billboard-song.tex")

rank <- join(clean, song, match = "first")
rank <- rank[c("id", "date", "rank")]
rank$date <- as.character(rank$date)
xtable(rank[1:15, ], "billboard-rank.tex")


